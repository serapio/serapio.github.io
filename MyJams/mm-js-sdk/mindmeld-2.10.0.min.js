var Faye=function(){"use strict";var Faye={VERSION:"1.0.1",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,extend:function(e,t,n){if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)&&n===!1||e[i]!==t[i]&&(e[i]=t[i]));return e},random:function(e){return e=e||this.ID_LENGTH,csprng(e,36)},clientIdFromMessages:function(e){var t=this.filter([].concat(e),function(e){return"/meta/connect"===e.channel});return t[0]&&t[0].clientId},copyObject:function(e){var t,n,i;if(e instanceof Array){for(t=[],n=e.length;n--;)t[n]=Faye.copyObject(e[n]);return t}if("object"==typeof e){t=null===e?null:{};for(i in e)t[i]=Faye.copyObject(e[i]);return t}return e},commonElement:function(e,t){for(var n=0,i=e.length;i>n;n++)if(-1!==this.indexOf(t,e[n]))return e[n];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},map:function(e,t,n){if(e.map)return e.map(t,n);var i=[];if(e instanceof Array)for(var s=0,r=e.length;r>s;s++)i.push(t.call(n||null,e[s],s));else for(var o in e)e.hasOwnProperty(o)&&i.push(t.call(n||null,o,e[o]));return i},filter:function(e,t,n){if(e.filter)return e.filter(t,n);for(var i=[],s=0,r=e.length;r>s;s++)t.call(n||null,e[s],s)&&i.push(e[s]);return i},asyncEach:function(e,t,n,i){var s=e.length,r=-1,o=0,a=!1,c=function(){return o-=1,r+=1,r===s?n&&n.call(i):(t(e[r],u),void 0)},l=function(){if(!a){for(a=!0;o>0;)c();a=!1}},u=function(){o+=1,l()};u()},toJSON:function(e){return this.stringify?this.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t}):JSON.stringify(e)}};return"undefined"!=typeof module?module.exports=Faye:"undefined"!=typeof window&&(window.Faye=Faye),Faye.Class=function(e,t){"function"!=typeof e&&(t=e,e=Object);var n=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},i=function(){};return i.prototype=e.prototype,n.prototype=new i,Faye.extend(n.prototype,t),n},function(){function e(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}var t=Faye.EventEmitter=function(){},n="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||n(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);t.apply(this,i)}return!0}if(n(t)){for(var i=Array.prototype.slice.call(arguments,1),s=t.slice(),r=0,o=s.length;o>r;r++)s[r].apply(this,i);return!0}return!1},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var n=this;return n.on(e,function i(){n.removeListener(e,i),t.apply(this,arguments)}),this},t.prototype.removeListener=function(t,i){if("function"!=typeof i)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var s=this._events[t];if(n(s)){var r=e(s,i);if(0>r)return this;s.splice(r,1),0==s.length&&delete this._events[t]}else this._events[t]===i&&delete this._events[t];return this},t.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}(),Faye.Namespace=Faye.Class({initialize:function(){this._used={}},exists:function(e){return this._used.hasOwnProperty(e)},generate:function(){for(var e=Faye.random();this._used.hasOwnProperty(e);)e=Faye.random();return this._used[e]=e},release:function(e){delete this._used[e]}}),function(){var e,t=setTimeout;e="function"==typeof setImmediate?function(e){setImmediate(e)}:"object"==typeof process&&process.nextTick?function(e){process.nextTick(e)}:function(e){t(e,0)};var n=0,i=1,s=2,r=function(e){return e},o=function(e){throw e},a=function(e){if(this._state=n,this._callbacks=[],this._errbacks=[],"function"==typeof e){var t=this;e(function(e){d(t,e)},function(e){f(t,e)})}};a.prototype.then=function(e,t){var n={},i=this;return n.promise=new a(function(s,r){n.fulfill=s,n.reject=r,c(i,e,n),l(i,t,n)}),n.promise};var c=function(e,t,s){"function"!=typeof t&&(t=r);var o=function(e){u(t,e,s)};e._state===n?e._callbacks.push(o):e._state===i&&o(e._value)},l=function(e,t,i){"function"!=typeof t&&(t=o);var r=function(e){u(t,e,i)};e._state===n?e._errbacks.push(r):e._state===s&&r(e._reason)},u=function(t,n,i){e(function(){h(t,n,i)})},h=function(e,t,n){var i,s,o,a=!1;try{if(i=e(t),s=typeof i,o=null!==i&&("function"===s||"object"===s)&&i.then,i===n.promise)return n.reject(new TypeError("Recursive promise chain detected"));if("function"!=typeof o)return n.fulfill(i);o.call(i,function(e){a||(a=!0,h(r,e,n))},function(e){a||(a=!0,n.reject(e))})}catch(c){if(a)return;a=!0,n.reject(c)}},d=a.fulfill=a.resolve=function(e,t){if(e._state===n){e._state=i,e._value=t,e._errbacks=[];for(var s,r=e._callbacks;s=r.shift();)s(t)}},f=a.reject=function(e,t){if(e._state===n){e._state=s,e._reason=t,e._callbacks=[];for(var i,r=e._errbacks;i=r.shift();)i(t)}};a.defer=e,a.deferred=a.pending=function(){var e={};return e.promise=new a(function(t,n){e.fulfill=e.resolve=t,e.reject=n}),e},a.fulfilled=a.resolved=function(e){return new a(function(t){t(e)})},a.rejected=function(e){return new a(function(t,n){n(e)})},"undefined"==typeof Faye?module.exports=a:Faye.Promise=a}(),Faye.Set=Faye.Class({initialize:function(){this._index={}},add:function(e){var t=void 0!==e.id?e.id:e;return this._index.hasOwnProperty(t)?!1:(this._index[t]=e,!0)},forEach:function(e,t){for(var n in this._index)this._index.hasOwnProperty(n)&&e.call(t,this._index[n])},isEmpty:function(){for(var e in this._index)if(this._index.hasOwnProperty(e))return!1;return!0},member:function(e){for(var t in this._index)if(this._index[t]===e)return!0;return!1},remove:function(e){var t=void 0!==e.id?e.id:e,n=this._index[t];return delete this._index[t],n},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),Faye.URI={isURI:function(e){return e&&e.protocol&&e.host&&e.path},isSameOrigin:function(e){var t=Faye.ENV.location;return e.protocol===t.protocol&&e.hostname===t.hostname&&e.port===t.port},parse:function(e){if("string"!=typeof e)return e;var t,n,i,s,r,o,a={},c=function(t,n){e=e.replace(n,function(e){return a[t]=e,""}),a[t]=a[t]||""};for(c("protocol",/^[a-z]+\:/i),c("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||a.host||(e=Faye.ENV.location.pathname.replace(/[^\/]*$/,"")+e),c("pathname",/^[^\?#]*/),c("search",/^\?[^#]*/),c("hash",/^#.*/),a.protocol=a.protocol||Faye.ENV.location.protocol,a.host?(a.host=a.host.substr(2),t=a.host.split(":"),a.hostname=t[0],a.port=t[1]||""):(a.host=Faye.ENV.location.host,a.hostname=Faye.ENV.location.hostname,a.port=Faye.ENV.location.port),a.pathname=a.pathname||"/",a.path=a.pathname+a.search,n=a.search.replace(/^\?/,""),i=n?n.split("&"):[],o={},s=0,r=i.length;r>s;s++)t=i[s].split("="),o[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return a.query=o,a.href=this.stringify(a),a},stringify:function(e){var t=e.protocol+"//"+e.hostname;return e.port&&(t+=":"+e.port),t+=e.pathname+this.queryString(e.query)+(e.hash||"")},queryString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return 0===t.length?"":"?"+t.join("&")}},Faye.Error=Faye.Class({initialize:function(e,t,n){this.code=e,this.params=Array.prototype.slice.call(t),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),Faye.Error.parse=function(e){if(e=e||"",!Faye.Grammar.ERROR.test(e))return new this(null,[],e);var t=e.split(":"),n=parseInt(t[0]),i=t[1].split(","),e=t[2];return new this(n,i,e)},Faye.Error.versionMismatch=function(){return new this(300,arguments,"Version mismatch").toString()},Faye.Error.conntypeMismatch=function(){return new this(301,arguments,"Connection types not supported").toString()},Faye.Error.extMismatch=function(){return new this(302,arguments,"Extension mismatch").toString()},Faye.Error.badRequest=function(){return new this(400,arguments,"Bad request").toString()},Faye.Error.clientUnknown=function(){return new this(401,arguments,"Unknown client").toString()},Faye.Error.parameterMissing=function(){return new this(402,arguments,"Missing required parameter").toString()},Faye.Error.channelForbidden=function(){return new this(403,arguments,"Forbidden channel").toString()},Faye.Error.channelUnknown=function(){return new this(404,arguments,"Unknown channel").toString()},Faye.Error.channelInvalid=function(){return new this(405,arguments,"Invalid channel").toString()},Faye.Error.extUnknown=function(){return new this(406,arguments,"Unknown extension").toString()},Faye.Error.publishFailed=function(){return new this(407,arguments,"Failed to publish").toString()},Faye.Error.serverError=function(){return new this(500,arguments,"Internal server error").toString()},Faye.Deferrable={then:function(e,t){var n=this;return this._promise||(this._promise=new Faye.Promise(function(e,t){n._fulfill=e,n._reject=t})),0===arguments.length?this._promise:this._promise.then(e,t)},callback:function(e,t){return this.then(function(n){e.call(t,n)})},errback:function(e,t){return this.then(null,function(n){e.call(t,n)})},timeout:function(e,t){this.then();var n=this;this._timer=Faye.ENV.setTimeout(function(){n._reject(t)},1e3*e)},setDeferredStatus:function(e,t){this._timer&&Faye.ENV.clearTimeout(this._timer);this.then();"succeeded"===e?this._fulfill(t):"failed"===e?this._reject(t):delete this._promise}},Faye.Publisher={countListeners:function(e){return this.listeners(e).length},bind:function(e,t,n){var i=Array.prototype.slice,s=function(){t.apply(n,i.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([e,t,n,s]),this.on(e,s)},unbind:function(e,t,n){this._listeners=this._listeners||[];for(var i,s=this._listeners.length;s--;)i=this._listeners[s],i[0]===e&&(!t||i[1]===t&&i[2]===n)&&(this._listeners.splice(s,1),this.removeListener(e,i[3]))}},Faye.extend(Faye.Publisher,Faye.EventEmitter.prototype),Faye.Publisher.trigger=Faye.Publisher.emit,Faye.Timeouts={addTimeout:function(e,t,n,i){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var s=this;this._timeouts[e]=Faye.ENV.setTimeout(function(){delete s._timeouts[e],n.call(i)},1e3*t)}},removeTimeout:function(e){this._timeouts=this._timeouts||{};var t=this._timeouts[e];t&&(clearTimeout(t),delete this._timeouts[e])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var e in this._timeouts)this.removeTimeout(e)}},Faye.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,t){if(Faye.logger){var e=Array.prototype.slice.apply(e),n="[Faye",i=this.className,s=e.shift().replace(/\?/g,function(){try{return Faye.toJSON(e.shift())}catch(t){return"[Object]"}});for(var r in Faye)i||"function"==typeof Faye[r]&&this instanceof Faye[r]&&(i=r);i&&(n+="."+i),n+="] ","function"==typeof Faye.logger[t]?Faye.logger[t](n+s):"function"==typeof Faye.logger&&Faye.logger(n+s)}}},function(){for(var e in Faye.Logging.LOG_LEVELS)(function(e){Faye.Logging[e]=function(){this.writeLog(arguments,e)}})(e,Faye.Logging.LOG_LEVELS[e])}(),Faye.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},Faye.Extensible={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,n,i,s){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return i.call(s,t);var r=this._extensions.slice(),o=function(t){if(!t)return i.call(s,t);var a=r.shift();if(!a)return i.call(s,t);var c=a[e];return c?(c.length>=3?a[e](t,n,o):a[e](t,o),void 0):o(t)};o(t)}},Faye.extend(Faye.Extensible,Faye.Logging),Faye.Channel=Faye.Class({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}}),Faye.extend(Faye.Channel.prototype,Faye.Publisher),Faye.extend(Faye.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),n=["/**",e],i=t.slice();i[i.length-1]="*",n.push(this.unparse(i));for(var s=1,r=t.length;r>s;s++)i=t.slice(0,s),i.push("**"),n.push(this.unparse(i));return n},isValid:function(e){return Faye.Grammar.CHANNEL_NAME.test(e)||Faye.Grammar.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:Faye.Class({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t,n){if(t)for(var i,s=0,r=e.length;r>s;s++){i=e[s];var o=this._channels[i]=this._channels[i]||new Faye.Channel(i);o.bind("message",t,n)}},unsubscribe:function(e,t,n){var i=this._channels[e];return i?(i.unbind("message",t,n),i.isUnused()?(this.remove(e),!0):!1):!1},distributeMessage:function(e){for(var t=Faye.Channel.expand(e.channel),n=0,i=t.length;i>n;n++){var s=this._channels[t[n]];s&&s.trigger("message",e.data)}}})}),Faye.Envelope=Faye.Class({initialize:function(e,t){this.id=e.id,this.message=e,void 0!==t&&this.timeout(t/1e3,!1)}}),Faye.extend(Faye.Envelope.prototype,Faye.Deferrable),Faye.Publication=Faye.Class(Faye.Deferrable),Faye.Subscription=Faye.Class({initialize:function(e,t,n,i){this._client=e,this._channels=t,this._callback=n,this._context=i,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),Faye.extend(Faye.Subscription.prototype,Faye.Deferrable),Faye.Client=Faye.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_RETRY:5,MAX_REQUEST_SIZE:2048,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),this._options=t||{},this.endpoint=Faye.URI.parse(e||this.DEFAULT_ENDPOINT),this.endpoints=this._options.endpoints||{},this.transports={},this.cookies=Faye.CookieJar&&new Faye.CookieJar,this.headers={},this.ca=this._options.ca,this._disabled=[],this._retry=this._options.retry||this.DEFAULT_RETRY;for(var n in this.endpoints)this.endpoints[n]=Faye.URI.parse(this.endpoints[n]);this.maxRequestSize=this.MAX_REQUEST_SIZE,this._state=this.UNCONNECTED,this._channels=new Faye.Channel.Set,this._messageId=0,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(this._options.interval||this.INTERVAL),timeout:1e3*(this._options.timeout||this.CONNECTION_TIMEOUT)},Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.indexOf(this._disabled,"autodisconnect")<0&&this.disconnect()},this)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this.headers[e]=t},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var n=this;this.info("Initiating handshake with ?",Faye.URI.stringify(this.endpoint)),this._selectTransport(Faye.MANDATORY_CONNECTION_TYPES),this._send({channel:Faye.Channel.HANDSHAKE,version:Faye.BAYEUX_VERSION,supportedConnectionTypes:[this._transport.connectionType]},function(i){i.successful?(this._state=this.CONNECTED,this._clientId=i.clientId,this._selectTransport(i.supportedConnectionTypes),this.info("Handshake successful: ?",this._clientId),this.subscribe(this._channels.getKeys(),!0),e&&Faye.Promise.defer(function(){e.call(t)})):(this.info("Handshake unsuccessful"),Faye.ENV.setTimeout(function(){n.handshake(e,t)},this._advice.interval),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._clientId),this._send({channel:Faye.Channel.CONNECT,clientId:this._clientId,connectionType:this._transport.connectionType},this._cycleConnection,this)))}},disconnect:function(){this._state===this.CONNECTED&&(this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._clientId),this._send({channel:Faye.Channel.DISCONNECT,clientId:this._clientId},function(e){e.successful&&(this._transport.close(),delete this._transport)},this),this.info("Clearing channel listeners for ?",this._clientId),this._channels=new Faye.Channel.Set)},subscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.subscribe(e,t,n)},this);var i=new Faye.Subscription(this,e,t,n),s=t===!0,r=this._channels.hasSubscription(e);return r&&!s?(this._channels.subscribe([e],t,n),i.setDeferredStatus("succeeded"),i):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._clientId,e),s||this._channels.subscribe([e],t,n),this._send({channel:Faye.Channel.SUBSCRIBE,clientId:this._clientId,subscription:e},function(s){if(!s.successful)return i.setDeferredStatus("failed",Faye.Error.parse(s.error)),this._channels.unsubscribe(e,t,n);var r=[].concat(s.subscription);this.info("Subscription acknowledged for ? to ?",this._clientId,r),i.setDeferredStatus("succeeded")},this)},this),i)},unsubscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.unsubscribe(e,t,n)},this);var i=this._channels.unsubscribe(e,t,n);i&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._clientId,e),this._send({channel:Faye.Channel.UNSUBSCRIBE,clientId:this._clientId,subscription:e},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._clientId,t)}},this)},this)},publish:function(e,t){var n=new Faye.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._clientId,e,t),this._send({channel:e,data:t,clientId:this._clientId},function(e){e.successful?n.setDeferredStatus("succeeded"):n.setDeferredStatus("failed",Faye.Error.parse(e.error))},this)},this),n},receiveMessage:function(e){var t,n=e.id;void 0!==e.successful&&(t=this._responseCallbacks[n],delete this._responseCallbacks[n]),this.pipeThroughExtensions("incoming",e,null,function(e){e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),t&&t[0].call(t[1],e))},this),this._transportUp!==!0&&(this._transportUp=!0,this.trigger("transport:up"))},messageError:function(e,t){for(var n,i,s=this._retry,r=this,o=0,a=e.length;a>o;o++)i=e[o],n=i.id,t?this._transportSend(i):Faye.ENV.setTimeout(function(){r._transportSend(i)},1e3*s);t||this._transportUp===!1||(this._transportUp=!1,this.trigger("transport:down"))},_selectTransport:function(e){Faye.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,Faye.URI.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e)},this)},_send:function(e,t,n){this._transport&&(e.id=e.id||this._generateMessageId(),this.pipeThroughExtensions("outgoing",e,null,function(e){e&&(t&&(this._responseCallbacks[e.id]=[t,n]),this._transportSend(e))},this))},_transportSend:function(e){if(this._transport){var t=1.2*(this._advice.timeout||1e3*this._retry),n=new Faye.Envelope(e,t);n.errback(function(t){this.messageError([e],t)},this),this._transport.send(n)}},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_handleAdvice:function(e){Faye.extend(this._advice,e),this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&void 0!==e.data&&(this.info("Client ? calling listeners for ? with ?",this._clientId,e.channel,e.data),this._channels.distributeMessage(e))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._clientId));var e=this;Faye.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),Faye.extend(Faye.Client.prototype,Faye.Deferrable),Faye.extend(Faye.Client.prototype,Faye.Publisher),Faye.extend(Faye.Client.prototype,Faye.Logging),Faye.extend(Faye.Client.prototype,Faye.Extensible),Faye.Transport=Faye.extend(Faye.Class({MAX_DELAY:0,batching:!0,initialize:function(e,t){this._client=e,this.endpoint=t,this._outbox=[]},close:function(){},encode:function(){return""},send:function(e){var t=e.message;return this.debug("Client ? sending message to ?: ?",this._client._clientId,Faye.URI.stringify(this.endpoint),t),this.batching?(this._outbox.push(e),t.channel===Faye.Channel.HANDSHAKE?this.addTimeout("publish",.01,this.flush,this):(t.channel===Faye.Channel.CONNECT&&(this._connectMessage=t),this.flushLargeBatch(),this.addTimeout("publish",this.MAX_DELAY,this.flush,this),void 0)):this.request([e])},flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),this.request(this._outbox),this._connectMessage=null,this._outbox=[]},flushLargeBatch:function(){var e=this.encode(this._outbox);if(!(e.length<this._client.maxRequestSize)){var t=this._outbox.pop();this.flush(),t&&this._outbox.push(t)}},receive:function(e,t){for(var n=e.length;n--;)e[n].setDeferredStatus("succeeded");t=[].concat(t),this.debug("Client ? received from ?: ?",this._client._clientId,Faye.URI.stringify(this.endpoint),t);for(var i=0,n=t.length;n>i;i++)this._client.receiveMessage(t[i])},handleError:function(e,t){for(var n=e.length;n--;)e[n].setDeferredStatus("failed",t)},_getCookies:function(){var e=this._client.cookies;return e?e.getCookies({domain:this.endpoint.hostname,path:this.endpoint.path,secure:"https:"===this.endpoint.protocol}).toValueString():""},_storeCookies:function(e){if(e&&this._client.cookies){e=[].concat(e);for(var t,n=0,i=e.length;i>n;n++)t=this._client.cookies.setCookie(e[n]),t=t[0]||t,t.domain=t.domain||this.endpoint.hostname}}}),{get:function(e,t,n,i,s){var r=e.endpoint;Faye.asyncEach(this._transports,function(o,a){var c=o[0],l=o[1],u=e.endpoints[c]||r;return Faye.indexOf(n,c)>=0?a():Faye.indexOf(t,c)<0?(l.isUsable(e,u,function(){}),a()):(l.isUsable(e,u,function(t){if(!t)return a();var n=l.hasOwnProperty("create")?l.create(e,u):new l(e,u);i.call(s,n)}),void 0)},function(){throw new Error("Could not find a usable connection type for "+Faye.URI.stringify(r))})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},_transports:[]}),Faye.extend(Faye.Transport.prototype,Faye.Logging),Faye.extend(Faye.Transport.prototype,Faye.Timeouts),Faye.Event={_registry:[],on:function(e,t,n,i){var s=function(){n.call(i)};e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s),this._registry.push({_element:e,_type:t,_callback:n,_context:i,_handler:s})},detach:function(e,t,n,i){for(var s,r=this._registry.length;r--;)s=this._registry[r],e&&e!==s._element||t&&t!==s._type||n&&n!==s._callback||i&&i!==s._context||(s._element.removeEventListener?s._element.removeEventListener(s._type,s._handler,!1):s._element.detachEvent("on"+s._type,s._handler),this._registry.splice(r,1),s=null)}},void 0!==Faye.ENV.onunload&&Faye.Event.on(Faye.ENV,"unload",Faye.Event.detach,Faye.Event),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,s,r,o,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(r=c.length,n=0;r>n;n+=1)o[n]=str(n,c)||"null";return s=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,s}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],s=str(i,c),s&&o.push(quote(i)+(gap?": ":":")+s));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(s=str(i,c),s&&o.push(quote(i)+(gap?": ":":")+s));return s=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,s}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;Faye.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},"function"!=typeof JSON.stringify&&(JSON.stringify=Faye.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,s=e[t];if(s&&"object"==typeof s)for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i=walk(s,n),void 0!==i?s[n]=i:delete s[n]);return reviver.call(e,t,s)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Faye.Transport.WebSocket=Faye.extend(Faye.Class(Faye.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){this._pending=this._pending||new Faye.Set;for(var t=0,n=e.length;n>t;t++)this._pending.add(e[t]);this.callback(function(t){if(t){var n=Faye.map(e,function(e){return e.message});t.send(Faye.toJSON(n))}},this),this.connect()},connect:function(){if(!Faye.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=this._createSocket();if(!e)return this.setDeferredStatus("failed");var t=this;e.onopen=function(){e.headers&&t._storeCookies(e.headers["set-cookie"]),t._socket=e,t._state=t.CONNECTED,t._everConnected=!0,t._ping(),t.setDeferredStatus("succeeded",e)};var n=!1;e.onclose=e.onerror=function(){if(!n){n=!0;var i=t._state===t.CONNECTED;e.onopen=e.onclose=e.onerror=e.onmessage=null,delete t._socket,t._state=t.UNCONNECTED,t.removeTimeout("ping"),t.setDeferredStatus("unknown");var s=t._pending?t._pending.toArray():[];delete t._pending,i?t.handleError(s,!0):t._everConnected?t.handleError(s):t.setDeferredStatus("failed")}},e.onmessage=function(e){var n,i=JSON.parse(e.data),s=[];if(i){i=[].concat(i);for(var r=0,o=i.length;o>r;r++)void 0!==i[r].successful&&(n=t._pending.remove(i[r]),n&&s.push(n));t.receive(s,i)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var e=Faye.Transport.WebSocket.getSocketUrl(this.endpoint),t={headers:Faye.copyObject(this._client.headers),ca:this._client.ca};return t.headers.Cookie=this._getCookies(),Faye.WebSocket?new Faye.WebSocket.Client(e,[],t):Faye.ENV.MozWebSocket?new MozWebSocket(e):Faye.ENV.WebSocket?new WebSocket(e):void 0},_ping:function(){this._socket&&(this._socket.send("[]"),this.addTimeout("ping",this._client._advice.timeout/2e3,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(e,t){var n=e.transports.websocket=e.transports.websocket||{};return n[t.href]=n[t.href]||new this(e,t),n[t.href]},getSocketUrl:function(e){return e=Faye.copyObject(e),e.protocol=this.PROTOCOLS[e.protocol],Faye.URI.stringify(e)},isUsable:function(e,t,n,i){this.create(e,t).isUsable(n,i)}}),Faye.extend(Faye.Transport.WebSocket.prototype,Faye.Deferrable),Faye.Transport.register("websocket",Faye.Transport.WebSocket),Faye.Event&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.Transport.WebSocket._unloaded=!0}),Faye.Transport.EventSource=Faye.extend(Faye.Class(Faye.Transport,{initialize:function(e,t){if(Faye.Transport.prototype.initialize.call(this,e,t),!Faye.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new Faye.Transport.XHR(e,t),t=Faye.copyObject(t),t.pathname+="/"+e._clientId;var n=new EventSource(Faye.URI.stringify(t)),i=this;n.onopen=function(){i._everConnected=!0,i.setDeferredStatus("succeeded")},n.onerror=function(){i._everConnected?i._client.messageError([]):(i.setDeferredStatus("failed"),n.close())},n.onmessage=function(e){i.receive([],JSON.parse(e.data))},this._socket=n},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(e,t){this.callback(function(){e.call(t,!0)
}),this.errback(function(){e.call(t,!1)})},encode:function(e){return this._xhr.encode(e)},request:function(e){this._xhr.request(e)}}),{isUsable:function(e,t,n,i){var s=e._clientId;return s?(Faye.Transport.XHR.isUsable(e,t,function(s){return s?(this.create(e,t).isUsable(n,i),void 0):n.call(i,!1)},this),void 0):n.call(i,!1)},create:function(e,t){var n=e.transports.eventsource=e.transports.eventsource||{},i=e._clientId;t=Faye.copyObject(t),t.pathname+="/"+(i||"");var s=Faye.URI.stringify(t);return n[s]=n[s]||new this(e,t),n[s]}}),Faye.extend(Faye.Transport.EventSource.prototype,Faye.Deferrable),Faye.Transport.register("eventsource",Faye.Transport.EventSource),Faye.Transport.XHR=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message});return Faye.toJSON(t)},request:function(e){var t=this.endpoint.path,n=Faye.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,i=this;n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Pragma","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest");var s=this._client.headers;for(var r in s)s.hasOwnProperty(r)&&n.setRequestHeader(r,s[r]);var o=function(){n.abort()};Faye.Event.on(Faye.ENV,"beforeunload",o),n.onreadystatechange=function(){if(n&&4===n.readyState){var t=null,s=n.status,r=n.responseText,a=s>=200&&300>s||304===s||1223===s;if(Faye.Event.detach(Faye.ENV,"beforeunload",o),n.onreadystatechange=function(){},n=null,!a)return i.handleError(e);try{t=JSON.parse(r)}catch(c){}t?i.receive(e,t):i.handleError(e)}},n.send(this.encode(e))}}),{isUsable:function(e,t,n,i){n.call(i,Faye.URI.isSameOrigin(t))}}),Faye.Transport.register("long-polling",Faye.Transport.XHR),Faye.Transport.CORS=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message});return"message="+encodeURIComponent(Faye.toJSON(t))},request:function(e){var t,n=Faye.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,i=new n,s=this._client.headers,r=this;if(i.open("POST",Faye.URI.stringify(this.endpoint),!0),i.setRequestHeader){i.setRequestHeader("Pragma","no-cache");for(t in s)s.hasOwnProperty(t)&&i.setRequestHeader(t,s[t])}var o=function(){return i?(i.onload=i.onerror=i.ontimeout=i.onprogress=null,i=null,void 0):!1};i.onload=function(){var t=null;try{t=JSON.parse(i.responseText)}catch(n){}o(),t?r.receive(e,t):r.handleError(e)},i.onerror=i.ontimeout=function(){o(),r.handleError(e)},i.onprogress=function(){},i.send(this.encode(e))}}),{isUsable:function(e,t,n,i){if(Faye.URI.isSameOrigin(t))return n.call(i,!1);if(Faye.ENV.XDomainRequest)return n.call(i,t.protocol===Faye.ENV.location.protocol);if(Faye.ENV.XMLHttpRequest){var s=new Faye.ENV.XMLHttpRequest;return n.call(i,void 0!==s.withCredentials)}return n.call(i,!1)}}),Faye.Transport.register("cross-origin-long-polling",Faye.Transport.CORS),Faye.Transport.JSONP=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message}),n=Faye.copyObject(this.endpoint);return n.query.message=Faye.toJSON(t),n.query.jsonp="__jsonp"+Faye.Transport.JSONP._cbCount+"__",Faye.URI.stringify(n)},request:function(e){var t=Faye.map(e,function(e){return e.message}),n=document.getElementsByTagName("head")[0],i=document.createElement("script"),s=Faye.Transport.JSONP.getCallbackName(),r=Faye.copyObject(this.endpoint),o=this;r.query.message=Faye.toJSON(t),r.query.jsonp=s,Faye.ENV[s]=function(t){if(!Faye.ENV[s])return!1;Faye.ENV[s]=void 0;try{delete Faye.ENV[s]}catch(n){}i.parentNode.removeChild(i),o.receive(e,t)},i.type="text/javascript",i.src=Faye.URI.stringify(r),n.appendChild(i)}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,n,i){n.call(i,!0)}}),Faye.Transport.register("callback-polling",Faye.Transport.JSONP),Faye}();!function(){function e(t,n,i){var s;if("array"===g(n))n.forEach(function(n,s){v.test(t)?i(t,n):e(t+"["+("object"==typeof n?s:"")+"]",n,i)});else if("object"===g(n))for(s in n)e(t+"["+s+"]",n[s],i);else i(t,n)}function t(){return!0}function n(e,n,i,s){return e.global?t(n||E,i,s):void 0}function i(e){e.global&&0===x.active++&&n(e,null,"ajaxStart")}function s(e){e.global&&!--x.active&&n(e,null,"ajaxStop")}function r(e,t){var i=t.context;return t.beforeSend.call(i,e,t)===!1||n(t,i,"ajaxBeforeSend",[e,t])===!1?!1:(n(t,i,"ajaxSend",[e,t]),void 0)}function o(e,t,i){var s=i.context,r="success";i.success.call(s,e,r,t),n(i,s,"ajaxSuccess",[t,i,e]),c(r,t,i)}function a(e,t,i,s){var r=s.context;s.error.call(r,i,t,e),n(s,r,"ajaxError",[i,s,e]),c(t,i,s)}function c(e,t,i){var r=i.context;i.complete.call(r,t,e),n(i,r,"ajaxComplete",[t,i]),s(i)}function l(){}function u(e){return e&&(e==F?"html":e==C?"json":S.test(e)?"script":T.test(e)&&"xml")||"text"}function h(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function d(e){"object"===g(e.data)&&(e.data=_(e.data)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=h(e.url,e.data))}function f(e){var t=Array.prototype.slice;return t.call(arguments,1).forEach(function(t){for(p in t)void 0!==t[p]&&(e[p]=t[p])}),e}var p,y,g=function(e){switch(toString.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if("object"==typeof e&&e&&"number"==typeof e.length)try{if("function"==typeof e.callee)return"arguments"}catch(t){if(t instanceof TypeError)return"arguments"}return null===e?"null":void 0===e?"undefined":e&&1===e.nodeType?"element":e===Object(e)?"object":typeof e},m=/%20/g,v=/\[\]$/,_=function(t){var n,i=[],s=function(e,t){t="function"===g(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};for(n in t)e(n,t[n],s);return i.join("&").replace(m,"+")},b=0,E=window.document,S=/^(?:text|application)\/javascript/i,T=/^(?:text|application)\/xml/i,C="application/json",F="text/html",I=/^\s*$/,x=function(e){var t=f({},e||{});for(p in x.settings)void 0===t[p]&&(t[p]=x.settings[p]);i(t),t.crossDomain||(t.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(t.url)&&RegExp.$2!=window.location.host);var n=t.dataType,s=/=\?/.test(t.url);if("jsonp"==n||s)return s||(t.url=h(t.url,"callback=?")),x.JSONP(t);t.url||(t.url=window.location.toString()),d(t);var c,g=t.accepts[n],m={},v=/^([\w-]+:)\/\//.test(t.url)?RegExp.$1:window.location.protocol,_=x.settings.xhr();t.crossDomain||(m["X-Requested-With"]="XMLHttpRequest"),g&&(m.Accept=g,g.indexOf(",")>-1&&(g=g.split(",",2)[0]),_.overrideMimeType&&_.overrideMimeType(g)),(t.contentType||t.data&&"GET"!=t.type.toUpperCase())&&(m["Content-Type"]=t.contentType||"application/x-www-form-urlencoded"),t.headers=f(m,t.headers||{}),_.onreadystatechange=function(){if(4==_.readyState){clearTimeout(c);var e,i=!1;if(_.status>=200&&_.status<300||304==_.status||0==_.status&&"file:"==v){n=n||u(_.getResponseHeader("content-type")),e=_.responseText;try{"script"==n?(1,eval)(e):"xml"==n?e=_.responseXML:"json"==n&&(e=I.test(e)?null:JSON.parse(e))}catch(s){i=s}i?a(i,"parsererror",_,t):o(e,_,t)}else a(null,"error",_,t)}};var b="async"in t?t.async:!0;_.open(t.type,t.url,b);for(y in t.headers)_.setRequestHeader(y,t.headers[y]);return r(_,t)===!1?(_.abort(),!1):(t.timeout>0&&(c=setTimeout(function(){_.onreadystatechange=l,_.abort(),a(null,"timeout",_,t)},t.timeout)),_.send(t.data?t.data:null),_)};x.active=0,x.JSONP=function(e){if(!("type"in e))return x(e);var t,n="jsonp"+ ++b,i=E.createElement("script"),s=function(){n in window&&(window[n]=l),c("abort",r,e)},r={abort:s},a=E.getElementsByTagName("head")[0]||E.documentElement;return e.error&&(i.onerror=function(){r.abort(),e.error()}),window[n]=function(i){clearTimeout(t),delete window[n],o(i,r,e)},d(e),i.src=e.url.replace(/=\?/,"="+n),a.insertBefore(i,a.firstChild),e.timeout>0&&(t=setTimeout(function(){r.abort(),c("timeout",r,e)},e.timeout)),r},x.settings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:C,xml:"application/xml, text/xml",html:F,text:"text/plain"},crossDomain:!1,timeout:0},x.get=function(e,t){return x({url:e,success:t})},x.post=function(e,t,n,i){return"function"===g(t)&&(i=i||n,n=t,t=null),x({type:"POST",url:e,data:t,success:n,dataType:i})},x.getJSON=function(e,t){return x({url:e,success:t,dataType:"json"})};window.ajax=x}();var MM=function(e,t,n){var i=e.MM=e.MM||{};Object.defineProperty(i,"version",{value:"2.10.0",writable:!1});var s=function(e){return"function"==typeof e},r=function(e){return null!=e&&e===e.window},o=function(e){return"object"!=typeof e||e.nodeType||r(e)?!1:e.constructor&&!e.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},a=function(){var e,t,n,i,r,c,l=arguments[0]||{},u=1,h=arguments.length,d=!1;for("boolean"==typeof l&&(d=l,l=arguments[u]||{},u++),"object"==typeof l||s(l)||(l={}),u===h&&(l=this,u--);h>u;u++)if(null!=(r=arguments[u]))for(i in r)e=l[i],n=r[i],l!==n&&(d&&n&&(o(n)||(t=Array.isArray(n)))?(t?(t=!1,c=e&&Array.isArray(e)?e:[]):c=e&&o(e)?e:{},l[i]=a(d,c,n)):void 0!==n&&(l[i]=n));return l},c=function(e){var t;for(t in e)return!1;return!0},l=function(t){"complete"===e.document.readyState||"interactive"===e.document.readyState?t():e.document.onreadystatechange=function(){"interactive"===e.document.readyState&&t()}};return i.config={cleanUrl:"https://mindmeldv2.expectlabs.com/",fayeClientUrl:"https://pushv2.expectlabs.com:443/faye"},i.Internal=a({},{setup:function(){i.activeSessionID=null,i.activeUserID=null,i.activeDomainID=null},onReady:function(){i.Internal.initializeModels(),i.Internal.EventHandler.init(i.config.fayeClientUrl),i.Util.testAndCall(i.config.onInit)},initializeModels:function(){a(i,new i.models.App),i.documents=new i.models.AppDocumentList,i.domains=new i.models.AppDomainList,i.activeUser=new i.models.ActiveUser,i.activeUser.sessions=new i.models.SessionList,i.activeSession=new i.models.ActiveSession,i.activeSession.textentries=new i.models.TextEntryList,i.activeSession.entities=new i.models.EntityList,i.activeSession.documents=new i.models.SessionDocumentList,i.activeSession.liveusers=new i.models.LiveUserList,i.activeSession.invitedusers=new i.models.InvitedUserList},clearUserData:function(){i.activeUser.clearAllData(),i.activeUser.sessions.clearAllData()},clearSessionData:function(){i.activeSession.clearAllData(),i.activeSession.textentries.clearAllData(),i.activeSession.entities.clearAllData(),i.activeSession.documents.clearAllData(),i.activeSession.liveusers.clearAllData(),i.activeSession.invitedusers.clearAllData()},getDomainID:function(e){var t=i.activeDomainID;return void 0!==e&&null!==e&&("string"==typeof e?t=e:"object"==typeof e&&"domainid"in e&&(t=e.domainid)),t},noDomainError:{type:"NoDomainError",message:"No active domain or domain ID, cannot get documents"},override:function(e,t){a(e.prototype,t)},createSubclass:function(e,t){var n,s=Object.prototype.constructor,r=t.constructor,o=function(){},a=e.prototype;return o.prototype=a,n=r.prototype=new o,n.constructor=r,r.superclass=a,a.constructor===s&&(a.constructor=e),n.superclass=n.supr=function(){return a},n.proto=n,i.Internal.override(r,t),r},log:function(t){e.console&&e.console.log(t)},EventHandler:{fayeClient:null,fayeSubscriptions:{},namedEventHandlers:{},appChannelHandlers:{},userChannelHandlers:{},sessionChannelHandlers:{},init:function(e){this.fayeClient=new n.Client(e,{timeout:120});var t={outgoing:function(e,t){return"/meta/subscribe"!==e.channel?t(e):(e.ext||(e.ext={}),e.ext.authToken=i.token,t(e),void 0)}};this.fayeClient.addExtension(t)},subscribe:function(e,t,n){var s=i.Internal.EventHandler,r=e.channelConfig.channel,o=e.channelConfig.type,a=!0;if(void 0===this.fayeSubscriptions[r]){a=!1;var c=function(e){switch(void 0!==s.namedEventHandlers[r]&&i.Util.testAndCall(s.namedEventHandlers[r][e.event],e.payload),o){case"app":i.Util.testAndCall(s.appChannelHandlers[r],e);break;case"session":i.Util.testAndCall(s.sessionChannelHandlers[r],e);break;case"user":i.Util.testAndCall(s.userChannelHandlers[r],e)}},l=s.fayeClient.subscribe(r,c);s.fayeSubscriptions[r]=l,l.then(function(){i.config.debug&&i.Internal.log("SUCCESSFULLY CONNECTED TO CHANNEL: "+e.channel),i.Util.testAndCall(t)},function(t){i.Internal.log("COULD NOT CONNECT TO CHANNEL: "+e.channel+". Error: "+t.message),i.Util.testAndCall(n,t)})}a&&i.Util.testAndCall(t,r);var u=e.handler;if(e.subscribeAll)switch(o){case"app":s.appChannelHandlers[r]=u;break;case"session":s.sessionChannelHandlers[r]=u;break;case"user":s.userChannelHandlers[r]=u}else void 0===s.namedEventHandlers[r]&&(s.namedEventHandlers[r]={}),s.namedEventHandlers[r][e.name]=u},unsubscribe:function(e){var t=i.Internal.EventHandler,n=e.channelConfig.channel,s=e.channelConfig.type;if(e.subscribeAll)switch(s){case"app":delete t.appChannelHandlers[n];break;case"session":delete t.sessionChannelHandlers[n];break;case"user":delete t.userChannelHandlers[n]}else void 0!==this.namedEventHandlers[n]&&(delete t.namedEventHandlers[n][e.name],c(t.namedEventHandlers[n])&&delete t.namedEventHandlers[n]);var r=!1,o=void 0!==t.namedEventHandlers[n];if(!o)switch(s){case"app":r=void 0===t.appChannelHandlers[n];break;case"session":r=void 0===t.sessionChannelHandlers[n];break;case"user":r=void 0===t.userChannelHandlers[n]}if(r){var a=t.fayeSubscriptions[n];a&&(a.cancel(),delete this.fayeSubscriptions[n])}},clearAllEventsForChannel:function(e,t){var n=i.Internal.EventHandler;switch(delete n.namedEventHandlers[e],t){case"app":delete n.appChannelHandlers[e];break;case"session":delete n.sessionChannelHandlers[e];break;case"user":delete n.userChannelHandlers[e]}var s=n.fayeSubscriptions[e];s&&(s.cancel(),delete n.fayeSubscriptions[e]),i.config.debug&&i.Internal.log("Cleared all event handlers on "+e+" channel")}},customEventHandlers:{_publish:function(e,t){var n={name:e,payload:t},i=this.path()+"/events";this.makeModelRequest("POST",i,n)},_subscribe:function(e,t,n,s){var r={name:e,handler:t,subscribeAll:!1};r.channelConfig=this.getChannelConfig(),i.Internal.EventHandler.subscribe(r,n,s)},_unsubscribe:function(e){var t={name:e,subscribeAll:!1};t.channelConfig=this.getChannelConfig(),i.Internal.EventHandler.unsubscribe(t)},_subscribeAll:function(e,t,n){var s={subscribeAll:!0,handler:e};s.channelConfig=this.getChannelConfig(),i.Internal.EventHandler.subscribe(s,t,n)},_unsubscribeAll:function(){var e={subscribeAll:!0};e.channelConfig=this.getChannelConfig(),i.Internal.EventHandler.unsubscribe(e)}}}),a(i,{init:function(e){var t=i.config;i.config=a({},t,e),l(function(){i.Internal.onReady()})},start:function(t,n,s){n=n||function(){},s=s||function(e){console.error("Error initializing MindMeld:",e)},t.appid||s("You must supply the appid in the config object.");var r=function(){var t="mindmeld_anon_user_id",n=i.support.localStorage&&localStorage.getItem(t);if(!n){var s=Math.random().toString(36).substr(2);n="mindmeld-anon-"+s,i.support.localStorage&&localStorage.setItem(t,n)}return{anonymous:{userid:n,name:"Anonymous User",domain:e.location.hostname}}},o=function(){t.domainid?(i.setActiveDomainID(t.domainid),n()):i.domains.get(function(e){e.data.length>0&&i.setActiveDomainID(e.data[0].domainid),n()},s)},a=function(){if(t.sessionid)i.setActiveSessionID(t.sessionid,o,s);else{var e=t.session;if(!e){var n=new Date,r="MindMeld - "+n.toTimeString()+" "+n.toDateString();e={name:r,privacymode:"inviteonly"}}i.activeUser.sessions.post(e,function(e){i.setActiveSessionID(e.data.sessionid,o,s)},s)}};t.onInit=function(){if(t.token&&t.userid)i.setToken(t.token,function(){i.setActiveUserID(t.userid),a()},s);else{var e=t.credentials||r();i.getToken(e,function(){a()},s)}},i.init(t)},getToken:function(e,t,n){function s(e){e.data&&e.data.token?(i.token=e.data.token,o?i.get(null,function(n){var s=n.data.ownerid;i.setActiveUserID(s),i.Util.testAndCall(t,e.data)},function(e){i.Util.testAndCall(n,e)}):e.data.user&&e.data.user.userid&&(i.setActiveUserID(e.data.user.userid),i.Util.testAndCall(t,e.data))):i.Util.testAndCall(n,e)}var r={"X-MindMeld-Appid":i.config.appid},o=!1,a=null;if(e.facebook||e.anonymous)a={credentials:e},a=JSON.stringify(a);else if(e.appsecret&&e.simple)r["X-MindMeld-Appsecret"]=e.appsecret,a={credentials:{simple:e.simple}},a=JSON.stringify(a);else{if(!e.appsecret){var c={code:14,type:"CredentialsInvalid",message:"A valid appsecret or either simple or facebook credentials are required."};return i.Util.testAndCall(n,c),void 0}r["X-MindMeld-Appsecret"]=e.appsecret,o=!0}i.callApi("POST","tokens",a,s,n,r)},revokeToken:function(e,t){function n(n){i.config.debug&&i.Internal.log("SUCCESSFULLY REVOKED TOKEN: "+i.token),i.token="",n.data?i.Util.testAndCall(e,n):i.Util.testAndCall(t,n)}i.callApi("DELETE","token/"+i.token,null,n,t)},setActiveSessionID:function(e,t,n){var s=i.config.appid+"/session/"+i.activeSessionID;i.Internal.EventHandler.clearAllEventsForChannel(s,"session"),i.activeSessionID=e,i.Internal.clearSessionData(),i.activeSession.get(null,t,n)},setActiveSession:function(e,t,n){i.setActiveSessionID(e,t,n)},setActiveUserID:function(e,t,n){var s=i.config.appid+"/user/"+i.activeUserID;i.Internal.EventHandler.clearAllEventsForChannel(s,"user"),i.activeUserID=e,i.Internal.clearUserData(),i.activeUser.get(null,t,n)},setActiveUser:function(e,t,n){i.setActiveUserID(e,t,n)},setActiveDomainID:function(e){i.activeDomainID=e},setToken:function(e,t,n){i.token=e,i.get(null,function(){i.Util.testAndCall(t)},function(){i.Util.testAndCall(n)})},callApi:function(e,n,s,r,o,a){var c=!1;s&&s["if-modified-since"]&&(c=!0,delete s["if-modified-since"]),a=a||{"X-MINDMELD-ACCESS-TOKEN":i.token};var l=i.config.cleanUrl+n;i.config.debug&&i.Internal.log("Calling MindMeld API with: "+e+" and URL: "+l+" and Params: "+JSON.stringify(s)),t({type:e,url:l,data:s,dataType:"json",headers:a,ifModified:c,success:function(e,t){i.config.debug&&i.Internal.log("The MindMeld request returned: "+JSON.stringify(e)),"notmodified"===t?i.Util.testAndCall(o,t):e?e.data?i.Util.testAndCall(r,e):e.error&&i.Util.testAndCall(o,e.error):i.Util.testAndCall(o,e)},error:function(e,t,n){var s="Ajax Request Error: XMLHTTPRequestObject status: ("+e.status+", "+e.statusText+"), text status: ("+t+"), error thrown: ("+n+")";i.Internal.log("The MindMeld AJAX request failed with the error: "+s),i.Internal.log(e.responseText),i.Internal.log(e.getAllResponseHeaders());var r={code:0,type:"FailedAjaxRequest",message:""+n};i.Util.testAndCall(o,r)}})}}),i.models={},i.models.Model=i.Internal.createSubclass(Object,{constructor:function(){this.result=null,this.shouldPersist=!0,this.updateHandler=null,this.eTag=null},backupData:function(){if(i.support.localStorage)try{e.localStorage[this.localStoragePath()]=JSON.stringify(this.result)}catch(t){}},clearAllData:function(){this.result=null,this.clearLocalData()},clearLocalData:function(){i.support.localStorage&&e.localStorage.removeItem(this.localStoragePath())},_get:function(e,t,n){function s(e){i.Util.testAndCall(r,e),i.Util.testAndCall(t,e)}this.makeModelRequest("GET",this.path(),e,s,n);var r=this.updateHandler},restore:function(t,n){if(i.support.localStorage){var s=e.localStorage[this.localStoragePath()];if(s&&(s=JSON.parse(s)))return this.result=s,i.Util.testAndCall(t),void 0}i.Util.testAndCall(n)},_json:function(){return this.result&&this.result.data?this.result.data:null},makeModelRequest:function(e,t,n,s,r){var o=this,a=function(e){e.request&&e.request.method&&"GET"===e.request.method.toUpperCase()&&(o.result=e,o.shouldPersist&&o.backupData(),e.etag&&(o.eTag=e.etag)),e.data?i.Util.testAndCall(s,e):i.Util.testAndCall(r,e)},c={"X-MINDMELD-ACCESS-TOKEN":i.token};n&&n["if-none-match"]&&null!==this.eTag&&(c["if-none-match"]=this.eTag,delete n["if-none-match"]),i.callApi(e,t,n,a,r,c)},getChannelConfig:function(){var e={},t="/"+i.config.appid;switch(this.channelType){case"app":e.type=this.channelType,e.channel=t;break;case"session":e.type=this.channelType,e.channel=t+"/session/"+i.activeSessionID;break;case"user":e.type=this.channelType,e.channel=t+"/user/"+i.activeUserID}return e},_onUpdate:function(e,t,n,r){if(this.updateHandler=e,this.updateEventName&&this.channelType){var o={name:this.updateEventName,subscribeAll:!1};if(o.channelConfig=this.getChannelConfig(),e){var a=this;o.handler=function(){var e=null;s(r)&&(e=r()),a.get(e)},i.Internal.EventHandler.subscribe(o,t,n)}else i.Internal.EventHandler.unsubscribe(o)}else i.Util.testAndCall(n)},localStoragePath:function(){return""},path:function(){return""}}),i.models.App=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.App.superclass.constructor.apply(this,arguments),a(this,i.Internal.customEventHandlers)},localStoragePath:function(){return"MM.app"},path:function(){return""},json:function(){return this._json()},onUpdate:function(e){this._onUpdate(e,null,null)},get:function(e,t,n){this._get(null,t,n)},post:function(e,t,n){this.makeModelRequest("POST",this.path(),e,t,n)},publish:function(e,t){this._publish(e,t)},subscribe:function(e,t,n,i){this._subscribe(e,t,n,i)},unsubscribe:function(e){this._unsubscribe(e)},subscribeAll:function(e,t,n){this._subscribeAll(e,t,n)},unsubscribeAll:function(){this._unsubscribeAll()},channelType:"app"}),i.models.ActiveUser=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.ActiveUser.superclass.constructor.apply(this,arguments),a(this,i.Internal.customEventHandlers)},localStoragePath:function(){return"MM.activeUser"},path:function(){return"user/"+i.activeUserID},json:function(){return this._json()},onUpdate:function(e){this._onUpdate(e,null,null)},get:function(e,t,n){this._get(null,t,n)},post:function(e,t,n){this.makeModelRequest("POST",this.path(),e,t,n)},setLocation:function(e,t,n,s){var r={location:{latitude:e,longitude:t}};i.activeUser.post(r,n,s)},publish:function(e,t){this._publish(e,t)},subscribe:function(e,t,n,i){this._subscribe(e,t,n,i)},unsubscribe:function(e){this._unsubscribe(e)},subscribeAll:function(e,t,n){this._subscribeAll(e,t,n)},unsubscribeAll:function(){this._unsubscribeAll()},channelType:"user"}),i.models.SessionList=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.SessionList.superclass.constructor.apply(this,arguments)},localStoragePath:function(){return"MM.activeUser.sessions"},path:function(){return"user/"+i.activeUserID+"/sessions"},json:function(){return this._json()},onUpdate:function(e,t,n,i){this._onUpdate(e,t,n,i)},get:function(e,t,n){this._get(e,t,n)},post:function(e,t,n){this.makeModelRequest("POST",this.path(),e,t,n)},"delete":function(e,t,n){this.makeModelRequest("DELETE","session/"+e,null,t,n)},channelType:"user",updateEventName:"sessionsUpdate"}),i.models.TextEntry=i.Internal.createSubclass(i.models.Model,{constructor:function(e){i.models.TextEntry.superclass.constructor.apply(this,arguments);for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},localStoragePath:function(){return"MM.textEntry"},path:function(){return"textentry/"+this.textentryid},json:function(){return this._json()},get:function(e,t,n){this._get(null,t,n)},post:function(e,t,n){var s=function(n){var s=this;for(var r in e)e.hasOwnProperty(r)&&(s[r]=e[r]);i.Util.testAndCall(t,n)};this.makeModelRequest("POST",this.path(),e,s,n)}}),i.models.TextEntryList=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.TextEntryList.superclass.constructor.apply(this,arguments),this.textEntryPostedHandlers=[],this.interimTextEntry=null,this.textSegmentID=null,this.addTextEntryPostedHandler(function(e){i.Util.testAndCallThis(i.activeSession._onTextEntryPosted,i.activeSession.listener,e)})},localStoragePath:function(){return"MM.activeSession.textentries"},path:function(){return"session/"+i.activeSessionID+"/textentries"},json:function(){return this._json()},onUpdate:function(e,t,n,i){this._onUpdate(e,t,n,i)},get:function(e,t,n){this._get(e,t,n)},post:function(e,t,n){function s(e){i.Util.testAndCallThis(this._onTextEntryPosted,this,e),i.Util.testAndCall(t,e)}this.makeModelRequest("POST",this.path(),e,s,n)},submitTextEntry:function(e){function t(e){i.Util.testAndCallThis(n._onTextEntryPosted,n,e),null!==n.interimTextEntry&&n.interimTextEntry.segmentID===s.segmentID&&("final"===s.status?n.interimTextEntry=null:(n.interimTextEntry.textentryid=e.data.textentryid,n.interimTextEntry.resultID>s.resultID&&(s={text:n.interimTextEntry.text,type:n.interimTextEntry.type,weight:n.interimTextEntry.weight,status:n.interimTextEntry.status,language:n.interimTextEntry.language},console.log("posting update to text entry: "+s.text+" ("+s.textentryid+", "+s.status+")"),n.interimTextEntry.post(s,t))))}var n=this;if(void 0!==e.final&&e.segmentID&&e.resultID){e.segmentID!==n.textSegmentID&&(n.textSessionID=e.segmentID,n.interimTextEntry=null);var s={text:e.transcript,type:e.type||"speech",weight:1,status:e.final?"final":"interim",language:e.language,resultID:e.resultID,segmentID:e.segmentID};null===n.interimTextEntry||n.interimTextEntry.segmentID<n.textSegmentID?(n.interimTextEntry=new i.models.TextEntry(s),console.log("posting new text entry: "+s.text+" ("+s.status+")"),i.activeSession.textentries.post(s,t),n.textSegmentID=s.segmentID):n.interimTextEntry.segmentID===n.textSegmentID&&n.interimTextEntry.text!==s.text||n.interimTextEntry.text===s.text&&"final"===s.status?(s.textentryid=n.interimTextEntry.textentryid,n.interimTextEntry=new i.models.TextEntry(s),void 0!==n.interimTextEntry.textentryid&&(console.log("posting update to text entry: "+s.text+" ("+s.textentryid+", "+s.status+")"),n.interimTextEntry.post(s,t))):n.interimTextEntry.segmentID>n.textSegmentID&&console.error("Oops, something unexpected happened: the interim text entry's segmentID is greater than the current textSegmentID.")}else n.post(e)},addTextEntryPostedHandler:function(e){this.textEntryPostedHandlers.push(e)},_onTextEntryPosted:function(e){this.textEntryPostedHandlers.forEach(function(t){t(e)})},"delete":function(e,t,n){this.makeModelRequest("DELETE","textentry/"+e,null,t,n)},channelType:"session",updateEventName:"textentriesUpdate"}),i.models.EntityList=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.EntityList.superclass.constructor.apply(this,arguments)},localStoragePath:function(){return"MM.activeSession.entities"},path:function(){return"session/"+i.activeSessionID+"/entities"},json:function(){return this._json()},onUpdate:function(e,t,n,i){this._onUpdate(e,t,n,i)},get:function(e,t,n){this._get(e,t,n)},post:function(e,t,n){this.makeModelRequest("POST",this.path(),e,t,n)},"delete":function(e,t,n){this.makeModelRequest("DELETE","entity/"+e,null,t,n)},channelType:"session",updateEventName:"entitiesUpdate"}),i.models.SessionDocumentList=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.SessionDocumentList.superclass.constructor.apply(this,arguments)},localStoragePath:function(){return"MM.activeSession.documents"},path:function(){return"session/"+i.activeSessionID+"/documents"},json:function(){return this._json()},onUpdate:function(e,t,n,i){this._onUpdate(e,t,n,i)},get:function(e,t,n){if(e=e||{},!("domainid"in e)){if(null===i.activeDomainID)return i.Util.testAndCall(n,i.Internal.noDomainError),void 0;e.domainid=i.activeDomainID}this._get(e,t,n)},channelType:"session",updateEventName:"documentsUpdate"}),i.models.AppDocumentList=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.AppDocumentList.superclass.constructor.apply(this,arguments),this.domainID=null},localStoragePath:function(){return"MM.documents"},path:function(){return"domain/"+this.domainID+"/documents"},json:function(){return this._json()},onUpdate:function(e){this._onUpdate(e,null,null)},get:function(e,t,n){this.domainID=i.Internal.getDomainID(e),null!==this.domainID?this._get(e,t,n):i.Util.testAndCall(n,i.Internal.noDomainError)},post:function(e,t,n){this.domainID=i.Internal.getDomainID(e),null!==this.domainID?this.makeModelRequest("POST",this.path(),e,t,n):i.Util.testAndCall(n,i.Internal.noDomainError)},"delete":function(e,t,n,s){if(this.domainID=i.Internal.getDomainID(s),null!==this.domainID){var r="domain/"+this.domainID+"/document/"+e;this.makeModelRequest("DELETE",r,null,t,n)}else i.Util.testAndCall(n,i.Internal.noDomainError)}}),i.models.AppDomainList=new i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.AppDomainList.superclass.constructor.apply(this,arguments)},localStoragePath:function(){return"MM.domains"},path:function(){return"domains"},json:function(){return this._json()},get:function(e,t){this._get(null,e,t)},createNew:function(e,t,n){var i={uri:e};this.makeModelRequest("POST",this.path(),i,t,n)},"delete":function(e,t,n){this.makeModelRequest("DELETE","domain/"+e,null,t,n)}}),i.models.LiveUserList=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.LiveUserList.superclass.constructor.apply(this,arguments)},localStoragePath:function(){return"MM.activeSession.liveusers"},path:function(){return"session/"+i.activeSessionID+"/liveusers"},json:function(){return this._json()},onUpdate:function(e,t,n,i){this._onUpdate(e,t,n,i)},get:function(e,t,n){this._get(e,t,n)},post:function(e,t,n){this.makeModelRequest("POST",this.path(),e,t,n)},"delete":function(e,t,n){this.makeModelRequest("DELETE",this.path()+"/"+e,null,t,n)},channelType:"session",updateEventName:"liveusersUpdate"}),i.models.InvitedUserList=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.InvitedUserList.superclass.constructor.apply(this,arguments)},localStoragePath:function(){return"MM.activeSession.invitedusers"},path:function(){return"session/"+i.activeSessionID+"/invitedusers"},json:function(){return this._json()},onUpdate:function(e,t,n,i){this._onUpdate(e,t,n,i)},get:function(e,t,n){this._get(e,t,n)},post:function(e,t,n){this.makeModelRequest("POST",this.path(),e,t,n)},"delete":function(e,t,n){this.makeModelRequest("DELETE",this.path()+"/"+e,null,t,n)},channelType:"session",updateEventName:"invitedusersUpdate"}),i.models.ActiveSession=i.Internal.createSubclass(i.models.Model,{constructor:function(){i.models.ActiveSession.superclass.constructor.apply(this,arguments),this.registerListener(new i.Listener({interimResults:!0})),a(this,i.Internal.customEventHandlers)},registerListener:function(e){var t=this;this.listener=e,e.on("result",function(t){(t.final||e.postInterimResults===!0)&&i.activeSession.textentries.submitTextEntry(t)}),e.on("result",function(e,n,s,r){i.Util.testAndCallThis(t._onListenerResult,t.listener,e,n,s,r)}),e.on("start",function(e){i.Util.testAndCallThis(t._onListenerStart,t.listener,e)}),e.on("end",function(e){i.Util.testAndCallThis(t._onListenerEnd,t.listener,e)}),e.on("error",function(e){i.Util.testAndCallThis(t._onListenerError,t.listener,e)})},localStoragePath:function(){return"MM.activeSession"},path:function(){return"session/"+i.activeSessionID},json:function(){return this._json()},onUpdate:function(e){this._onUpdate(e,null,null)},setListenerConfig:function(e){var t={onResult:"_onListenerResult",onStart:"_onListenerStart",onEnd:"_onListenerEnd",onError:"_onListenerError",onTextEntryPosted:"_onTextEntryPosted"};for(var n in t)e.hasOwnProperty(n)&&("onResult"===n?this.listener.on("result",e[n]):"onStart"===n?this.listener.on("start",e[n]):"onEnd"===n?this.listener.on("end",e[n]):"onError"===n?this.listener.on("error",e[n]):this[t[n]]=e[n],delete e[n]);this.listener.setConfig(e)},get:function(e,t,n){this._get(null,t,n)},post:function(e,t,n){this.makeModelRequest("POST",this.path(),e,t,n)},publish:function(e,t){this._publish(e,t)},subscribe:function(e,t,n,i){this._subscribe(e,t,n,i)},unsubscribe:function(e){this._unsubscribe(e)},subscribeAll:function(e,t,n){this._subscribeAll(e,t,n)},unsubscribeAll:function(){this._unsubscribeAll()},channelType:"session"}),i.Util=a({},{testAndCall:function(e){if(s(e)){var t=Array.prototype.slice.call(arguments,1);e.apply(this,t)}},testAndCallThis:function(e,t){if(s(e)){var n=Array.prototype.slice.call(arguments,2);
e.apply(t,n)}},makeEventEmitter:function(e){var t={};e.on=function(e,n,i){t[e]||(t[e]=[]);var s={callback:n,context:i};t[e].push(s)},e.emit=function(e){var n=t[e];if(n){var i=Array.prototype.slice.call(arguments,1);n.forEach(function(e){var t=e.context||this;e.callback.apply(t,i)})}}}}),i.support=function(e){var t={},n=!1,i=!1;Object.defineProperties(t,{localStorage:{get:function(){return n}},speechRecognition:{get:function(){return i}}});try{i=function(e){"use strict";e=e||{};var t=e.webkitSpeechRecognition||e.SpeechRecognition;return e.SpeechRecognition=t,"undefined"!=typeof t}(e)}catch(s){}try{n=function(e){"use strict";return e=e||{},"undefined"!=typeof e.Storage}(e)}catch(s){}return t}(e),i.Internal.setup(),i}(window,ajax,Faye);!function(e){var t=function(e){var t={};for(var n in e)t[n]=e[n];return t},n=function(e){this.subscriptions={},this.continuous=!1,this.lang="",this.interimResults=!1,e.hasOwnProperty("earlyFinalResults")||(e.earlyFinalResults=!0),e.hasOwnProperty("postInterimResults")||(e.postInterimResults=!1),this.setConfig(e),this.segmentID=0,this.resultID=0,this.lastStartTime=0,this._listening=!1,this._results=[],this._pendingResult=null,this._rawEvents=[],this._captureEvents=!1};Object.defineProperties(n.prototype,{listening:{get:function(){return this._listening}},results:{get:function(){return JSON.parse(JSON.stringify(this._results))}}}),n.prototype.setConfig=function(e){var t=this,n={onResult:"_onResult",onStart:"_onStart",onEnd:"_onEnd",onError:"_onError",onTextEntryPosted:"_onTextEntryPosted",continuous:"continuous",interimResults:"interimResults",lang:"lang",earlyFinalResults:"earlyFinalResults",postInterimResults:"postInterimResults",onTrueFinalResult:"_onTrueFinalResult"};for(var i in n)e.hasOwnProperty(i)&&("onResult"===i?t.on("result",e[i]):"onStart"===i?t.on("start",e[i]):"onEnd"===i?t.on("end",e[i]):"onError"===i?t.on("error",e[i]):this[n[i]]=e[i])},n.prototype.on=function(e,t,n){this.subscriptions[e]||(this.subscriptions[e]=[]);var i={callback:t,context:n};this.subscriptions[e].push(i)},n.prototype.emit=function(e){var t=this.subscriptions[e];if(t){var n=Array.prototype.slice.call(arguments,1);t.forEach(function(e){var t=e.context||this;e.callback.apply(t,n)})}},n.prototype._initializeRecognizer=function(n){function i(){window.clearTimeout(a),a=window.setTimeout(function(){n.stop()},59500)}function s(){window.clearTimeout(c),c=window.setTimeout(function(){n.abort()},2e3)}function r(){o.earlyFinalResults&&(window.clearTimeout(l),l=window.setTimeout(h,1500))}var o=this,a=null,c=null,l=null,u=!1,h=function(){if(o._pendingResult){var e=t(o._pendingResult),n=o._results;o._pendingResult=null,e.final=!0,e.early=!0,n.push(e);var i=n.length-1;o.emit("result",e,i,n,event),u=!0}},d=function(e,t){t=t||{},t.type=e,t.timestamp=Date.now(),o._captureEvents&&o._rawEvents.push(t)},f=function(t){var i={"final":!1,transcript:"",segmentID:o.segmentID,resultID:o.resultID},s=n.lang;""!==s&&(i.language=e.Listener.convertLanguageToISO6392(s));for(var r=t.resultIndex;r<t.results.length;++r){var a=t.results[r][0].transcript;if(t.results[r].isFinal){i.final=!0,i._trueFinal=!0,o.segmentID++,i.transcript=a;break}i.transcript+=a}return o._results.length>0&&!/^\s/.test(i.transcript.charAt(0))&&(i.transcript=" "+i.transcript),i};n.onresult=function(e){o._captureEvents&&o._rawEvents.push(e),o.resultID++,null!==c&&s();var t=f(e);return u&&t.final?(u=!1,void 0):(t.final?(window.clearTimeout(l),l=null,o._pendingResult=null,o._results.push(t)):(o._pendingResult=t,r()),(t.final||o.interimResults)&&o.emit("result",t),void 0)},n.onstart=function(){d("start"),u=!1,o.segmentID++,o.resultID=0,i(),o._listening&&o._shouldKeepListening||(o._listening=!0,o.lastStartTime=Date.now(),o.emit("start"))},n.onend=function(){d("end"),window.clearTimeout(c),c=null,window.clearTimeout(a),a=null,window.clearTimeout(l),l=null,h(),u=!1,o._shouldKeepListening?n.start():(o._isStopping=!1,o._listening=!1,o.emit("end"))},n.onerror=function(e){if(o._captureEvents&&o._rawEvents.push(e),!o._shouldKeepListening||"no-speech"!==e.error){if("aborted"===e.error)return o._isStopping=!1,o._shouldKeepListening=!1,void 0;o._shouldKeepListening=!1,o.emit("error",e)}},n.onaudioend=function(){d("audioend"),n.continuous||s()},n.onaudiostart=function(){d("audiostart")},n.onsoundstart=function(){d("soundstart")},n.onspeechstart=function(){d("speechstart")},n.onspeechend=function(){d("speechend")},n.onsoundend=function(){d("soundend")},n.onnomatch=function(){d("nomatch")}},n.prototype.start=function(){if(!e.support.speechRecognition)throw e.Internal.log("Speech recognition is not supported"),new Error("Speech recognition is not supported");var t=this;if(Date.now()-t.lastStartTime<1e3)return e.Internal.log("Rapid start requests -- ignoring latest."),void 0;var n=this._recognizer;"undefined"==typeof n&&(n=this._recognizer=new window.SpeechRecognition,t._initializeRecognizer(n)),t._shouldKeepListening=!1,t._shouldKeepListening=n.continuous=this.continuous,n.interimResults=this.interimResults,n.lang=function(){var e="";return""!==t.lang?e=t.lang:window.document&&window.document.documentElement&&window.document.documentElement.lang&&(e=window.document.documentElement.lang),e}(),t._results=[],n.start()},n.prototype.stop=function(){this._shouldKeepListening=!1,this._recognizer&&(this._isStopping?this._recognizer.abort():(this._recognizer.stop(),this._isStopping=!0))},n.prototype.cancel=function(){this._shouldKeepListening=!1,this._recognizer&&this._recognizer.abort()};var i={ab:"abk",aa:"aar",af:"afr",sq:"sqi",am:"amh",ar:"ara",an:"arg",hy:"hye",as:"asm",ae:"ave",ay:"aym",az:"aze",ba:"bak",eu:"eus",be:"bel",bn:"ben",bh:"bih",bi:"bis",bs:"bos",br:"bre",bg:"bul",my:"mya",ca:"cat",ch:"cha",ce:"che",zh:"zho",cu:"chu",cv:"chv",kw:"cor",co:"cos",hr:"hrv",cs:"ces",da:"dan",dv:"div",nl:"nld",dz:"dzo",en:"eng",eo:"epo",et:"est",fo:"fao",fj:"fij",fi:"fin",fr:"fra",gd:"gla",gl:"glg",ka:"kat",de:"deu",el:"ell",gn:"grn",gu:"guj",ht:"hat",ha:"hau",he:"heb",hz:"her",hi:"hin",ho:"hmo",hu:"hun",is:"isl",io:"ido",id:"ind",ia:"ina",ie:"ile",iu:"iku",ik:"ipk",ga:"gle",it:"ita",ja:"jpn",jv:"jav",kl:"kal",kn:"kan",ks:"kas",kk:"kaz",km:"khm",ki:"kik",rw:"kin",ky:"kir",kv:"kom",ko:"kor",kj:"kua",ku:"kur",lo:"lao",la:"lat",lv:"lav",li:"lim",ln:"lin",lt:"lit",lb:"ltz",mk:"mkd",mg:"mlg",ms:"msa",ml:"mal",mt:"mlt",gv:"glv",mi:"mri",mr:"mar",mh:"mah",mo:"mol",mn:"mon",na:"nau",nv:"nav",nd:"nde",nr:"nbl",ng:"ndo",ne:"nep",se:"sme",no:"nor",nb:"nob",nn:"nno",ny:"nya",oc:"oci",or:"ori",om:"orm",os:"oss",pi:"pli",pa:"pan",fa:"fas",pl:"pol",pt:"por",ps:"pus",qu:"que",rm:"roh",ro:"ron",rn:"run",ru:"rus",sm:"smo",sg:"sag",sa:"san",sc:"srd",sr:"srp",sn:"sna",ii:"iii",sd:"snd",si:"sin",sk:"slk",sl:"slv",so:"som",st:"sot",es:"spa",su:"sun",sw:"swa",ss:"ssw",sv:"swe",tl:"tgl",ty:"tah",tg:"tgk",ta:"tam",tt:"tat",te:"tel",th:"tha",bo:"bod",ti:"tir",to:"ton",ts:"tso",tn:"tsn",tr:"tur",tk:"tuk",tw:"twi",ug:"uig",uk:"ukr",ur:"urd",uz:"uzb",vi:"vie",vo:"vol",wa:"wln",cy:"cym",fy:"fry",wo:"wol",xh:"xho",yi:"yid",yo:"yor",za:"zha",zu:"zul"};n.convertLanguageToISO6392=function(e){var t=e.substring(0,2),n=i[t];return"undefined"==typeof n&&(n=e.substring(0,3)),n},e.Listener=n}(MM);